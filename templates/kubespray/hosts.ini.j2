[all]
{# Load balancers #}
{% if infra.cluster.nodes.loadBalancer.instances is defined %}
{% for lb in infra.cluster.nodes.loadBalancer.instances %}
{{ lb.name }} ansible_host={{ lb.ip }}
{% endfor %}
{% endif %}
{# Master nodes #}
{% for master in infra.cluster.nodes.master.instances %}
{{ master.name }} ansible_host={{ master.ip }}
{% endfor %}
{# Worker nodes #}
{% if infra.cluster.nodes.worker.instances is defined %}
{% for worker in infra.cluster.nodes.worker.instances %}
{{ worker.name }} ansible_host={{ worker.ip }}
{% endfor %}
{% endif %}

[haproxy]
{% if infra.cluster.nodes.loadBalancer.instances is defined %}
{% for lb in infra.cluster.nodes.loadBalancer.instances %}
{{ lb.name }}
{% endfor %}
{% endif %}

[kube_control_plane]
{% for master in infra.cluster.nodes.master.instances %}
{{ master.name }}
{% endfor %}

[etcd]
{% for master in infra.cluster.nodes.master.instances %}
{{ master.name }}
{% endfor %}

[kube_node]
{% 
    if infra.cluster.nodes.worker.instances is defined 
    and infra.cluster.nodes.worker.instances | length > 0 
%}
{% for worker in infra.cluster.nodes.worker.instances %}
{{ worker.name }}
{% endfor %}
{# If no workers -> masters also become workers #}
{% else %}
{% for master in infra.cluster.nodes.master.instances %}
{{ master.name }}
{% endfor %}
{% endif %}

[k8s_cluster:children]
kube_control_plane
kube_node
